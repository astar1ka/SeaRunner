Класс `ActiveRecord`, как он работает:


    Этот класс представляет паттерн ActiveRecord и используется для взаимодействия с таблицами базы данных. 
    Паттерн ActiveRecord позволяет инкапсулировать логику работы с записями в таблице внутри объекта, 
    представляющего эту запись.

1. Свойства класса.

Свойство `primaryKey` устанавливает имя первичного ключа таблицы:

```typescript
protected primaryKey = 'id';
```
Свойство `fields` содержит список имен полей таблицы, а свойство `hidden` содержит список имен полей, которые нужно скрыть при выводе данных:

```typescript
protected fields: string [] = [];
```

Свойство `attributes` содержит атрибуты записи, которые могут быть изменены:

```typescript
protected hidden: string [] = [];
```
Конструктор этого класса принимает два параметра: объект `db`, представляющий экземпляр базы данных, и строку `table`, представляющую имя таблицы, с которой необходимо работать:

```typescript
constructor(readonly db: DB, readonly table: Tables){}
```    

2. Метод getData.

Метод `getData()` используется для получения данных записи в виде объекта типа `TAttributes`. 
Он начинается с создания пустого объекта `attributes`, который будет содержать атрибуты записи. 
Затем метод выполняет итерацию по каждому полю `field` из массива `this.fields`, который содержит список имен полей таблицы.
Для каждого поля `field` вызывается метод `get(field)`, который возвращает значение атрибута записи по указанному ключу. Полученное значение сохраняется в переменную `value`.
Далее, метод проверяет, если текущее поле `field` не находится в массиве `this.hidden`, используя метод `find`, который ищет совпадение значения `value` с полем `field`. Если совпадение не найдено, то значение `value` добавляется в объект `attributes` под ключом `field`.
После прохождения всех полей, метод возвращает объект `attributes`, содержащий только видимые атрибуты записи.
Таким образом, метод `getData()` фильтрует атрибуты записи, исключая те, которые находятся в массиве `this.hidden`, 
и возвращает объект с видимыми атрибутами записи. Это позволяет получать только необходимые данные записи и использовать их в дальнейшей работе: 

```typescript
    public getData(): TAttributes{
            const attributes: TAttributes = {};
            this.fields.forEach((field: string) => {
                const value = this.get(field);
                if (!this.hidden.find((value) => value === field)) attributes[field] = value;
            })
            return attributes;
        }
```

3. Метод rewrite.

Метод `reload(attributes: TAttributes)` используется для обновления атрибутов записи на основе переданных атрибутов.
Он пробегает по каждому полю `field` из массива `this.fields`, который содержит список имен полей таблицы.
Для каждого поля `field`, метод вызывает метод `get(field)`, который возвращает текущее значение атрибута записи по указанному ключу. Полученное значение сохраняется в переменную `value`.
Затем метод обновляет атрибуты записи, присваивая значение из переданных атрибутов `attributes[field]` текущему атрибуту `this.attributes[field]`. Таким образом, атрибут записи обновляется новым значением.
После прохождения всех полей, все атрибуты записи обновлены на основе переданных атрибутов.
Таким образом, метод `reload(attributes: TAttributes)` обновляет значения атрибутов записи на основе переданных атрибутов, используя список полей `this.fields` и метод `get(field)` для получения текущих значений атрибутов. Это позволяет обновлять атрибуты записи с помощью новых значений и использовать их в дальнейшей работе.

```typescript
    protected rewrite(attributes: TAttributes){
        this.fields.forEach((field: string) => {
            const value = this.get(field);
            this.attributes[field] = attributes[field];
        })
    }
```  

4. Метод get.

Метод `get(key: string)` используется для получения значения атрибута записи по указанному ключу.
Он принимает ключ `key` в качестве параметра, представляющий имя атрибута.
Метод просто возвращает значение атрибута, находящегося в свойстве `this.attributes` под указанным ключом `key`.
Таким образом, при вызове метода `get(key)`, он возвращает значение атрибута записи, соответствующее указанному ключу `key`. Это позволяет получать значения атрибутов записи для дальнейшего использования.

```typescript
    protected get(key: string){
        return this.attributes[key];
    }
```

5. Асинхронный метод refresh.

Метод `refresh()` используется для обновления данных записи путем получения актуальных данных из базы данных.
Метод начинается с проверки, если у записи есть значение первичного ключа, которое находится в свойстве `this.attributes[this.primaryKey]`. Если значение первичного ключа существует, выполняется следующий код.
Метод вызывает асинхронный метод `find()` у объекта `db` (экземпляр базы данных), передавая ему имя таблицы `this.table` и значение первичного ключа `this.attributes[this.primaryKey]`. 
Метод `find()` выполняет запрос к базе данных, чтобы найти запись с соответствующим значением первичного ключа.
Полученный результат запроса сохраняется в переменную `data`. 
Затем метод проверяет, если `data` не равно `null` или `undefined`, это означает, что запись была найдена в базе данных.
Внутри условия, метод вызывает метод `rewrite(data)`, который обновляет атрибуты записи на основе полученных данных `data`.
После обновления атрибутов, метод возвращает `true` для указания успешного обновления записи.
Если значение первичного ключа отсутствует или поиск записи не удался, метод возвращает `false`.
Таким образом, метод `refresh()` обновляет данные записи путем выполнения запроса к базе данных и замены текущих атрибутов на актуальные данные. Это позволяет синхронизировать объект `ActiveRecord` с актуальными данными из базы данных.

```typescript
    protected async refresh(): Promise<boolean>{
        if (this.attributes[this.primaryKey]) {
            const data = await this.db.find(this.table, this.attributes[this.primaryKey]);
            if (data) 
            {
                this.rewrite(data);
                return true;
            };
        }
        return false;
    }
```

6. Асинхронный метод create.

Метод `create(data: object)` используется для создания новой записи в базе данных на основе переданных данных.
Метод начинается с вызова асинхронного метода `addRecord()` у объекта `db` (экземпляр базы данных). Метод `addRecord()` принимает имя таблицы `this.table` и копию переданных данных `data`.
Результат выполнения метода `addRecord()` сохраняется в переменную `record`.
Затем метод проверяет, если `record` не равно `null` или `undefined`, это означает, что запись была успешно создана в базе данных.
Внутри условия, метод вызывает метод `rewrite(record)`, который обновляет атрибуты записи на основе созданной записи.
После обновления атрибутов, метод возвращает `true` для указания успешного создания записи.
Если создание записи не удалось или результат `addRecord()` равен `null` или `undefined`, метод возвращает `false`.
Таким образом, метод `create(data: object)` создает новую запись в базе данных, используя метод `addRecord()`, и обновляет атрибуты записи на основе созданной записи. Это позволяет добавлять новые записи в базу данных и обновлять атрибуты объекта `ActiveRecord` соответствующими значениями.

```typescript 
    protected async create(data: object): Promise<boolean>{
        const record = await this.db.addRecord(this.table, {...data});
        if (record) {
            this.rewrite(record);
            return true;
        }
        return false;
    }
```

7. Метод save.

Метод `save()` используется для сохранения изменений текущей записи в базе данных.
Метод начинается с вызова метода `updateRecord()` у объекта `db` (экземпляр базы данных). 
Метод `updateRecord()` принимает следующие параметры: имя таблицы `this.table`, значение первичного ключа `this.attributes[this.primaryKey]` и результат вызова метода `getData()`.
Метод `getData()` возвращает объект с актуальными данными записи, и этот результат передается в `updateRecord()`.
Таким образом, метод `save()` вызывает метод `updateRecord()` базы данных, передавая имя таблицы, значение первичного ключа текущей записи и актуальные данные записи для сохранения изменений в базе данных.
Это позволяет обновлять запись в базе данных с использованием новых значений атрибутов и сохранять изменения, сделанные в объекте `ActiveRecord`.

```typescript
    protected save(){
        this.db.updateRecord(this.table, this.attributes[this.primaryKey], this.getData());
    }
```

8. Метод getID.

Метод `getId()` используется для получения значения первичного ключа записи.
Метод просто вызывает метод `get('id')`, который возвращает значение атрибута с ключом `'id'`, то есть значение первичного ключа.
Затем метод возвращает полученное значение первичного ключа.
Таким образом, при вызове метода `getId()`, он возвращает значение первичного ключа записи. Это позволяет получать и использовать первичный ключ для идентификации и связи с другими записями в базе данных.

```typescript
    public getId():number{
        return this.get('id');
    }
```
